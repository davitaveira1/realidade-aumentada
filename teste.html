<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>MindAR Mobile Start</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />

  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <style>
    body { margin:0; overflow:hidden; }
    #startAR { position:fixed; z-index:10; bottom:20px; left:50%; transform:translateX(-50%);
               padding:12px 20px; font-size:16px; }
  </style>
</head>

<body>

<button id="startAR">Iniciar AR</button>

<a-scene
  id="scene"
  embedded
  vr-mode-ui="enabled:false"
  device-orientation-permission-ui="enabled:false"
  renderer="precision: mediump"
  mindar-image="imageTargetSrc: assets/targets.mind; uiScanning: yes; uiLoading: yes;">

  <a-camera
    position="0 0 0"
    look-controls="enabled:false"
    camera="facingMode: environment">
  </a-camera>

</a-scene>

<script>
  const button = document.getElementById('startAR');
  const sceneEl = document.getElementById('scene');

  // Log básico pra você saber se carregou
  sceneEl.addEventListener('loaded', () => console.log('[A-Frame] scene loaded'));

  button.addEventListener('click', async () => {
    button.style.display = 'none';

    try {
      const mindarSystem = sceneEl.systems["mindar-image-system"];
      if (!mindarSystem) {
        console.log('[MindAR] system not found');
        return;
      }

      console.log('[MindAR] starting...');
      await mindarSystem.start();              // <- FORÇA START NO MOBILE
      console.log('[MindAR] started');

      // garante que o render está rodando
      sceneEl.play();
    } catch (e) {
      console.log('[MindAR] start error:', e);
      alert('Erro ao iniciar AR: ' + (e && e.message ? e.message : e));
    }
  });
</script>

</body>
</html>
